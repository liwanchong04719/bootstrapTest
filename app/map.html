<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="stylesheet" type="text/css"
          href="../lib/Flat-UI-master/dist/css/vendor/bootstrap/css/bootstrap.min.css"/>
    <link href="../lib/select2-master/dist/css/select2.css" rel="stylesheet">
    <link href="../lib/select2-master/dist/css/select2-bootstrap-theme.css" rel="stylesheet">
    <link rel="stylesheet" href="../lib/accordion-multi-menu/css/style.css">
    <title>地图</title>
    <style>
        html,body{
            width: 100%;
            height: 100%;
            font-family: 'Microsoft YaHei', '微软雅黑', '黑体', Arial, 'Times New Roman', sans-serif;
        }

        #container{
            width: 100%;
            height: 100%;
        }

        #mainContainer{
            width: 100%;
            height: 100%;
        }
        #searchBar{
            position: absolute;
            width: 100%;
            padding: 2px 10px;
            z-index: 100;
        }

        .normal #searchStartBar{
            display: block;
        }

        .normal #searchResultBar{
            display: none;
        }

        .searched #searchStartBar{
            display: none;
        }

        .searched #searchResultBar{
            display: block;
        }

        #searchStartBar .input-group-addon{
            background-color: #fff;
            border: none;
        }

        #searchStartBar .input-group input{
            border: none;
        }

        #searchResultBar .input-group input{
            border: none;
        }

        #searchResultBar .input-group-addon{
            background-color: #fff;
            border: none;
        }

        #map{
            width: 100%;
            height: 100%;
        }
        #searchList{
            width: 100%;
            height: 100%;
        }
        .fulllScreen {
            padding-bottom: 0;
        }
        .halfScreen{
            padding-bottom: 50%;
        }
        .fulllScreen #searchList{
            display: none;
        }
        .halfScreen #searchList{
            display: block;
            margin-bottom: 0px;
        }

        #conditionContainer{
            width: 100%;
            height: 100%;
            padding: 5px 10px;
        }

        #conditionContainer .wrapper{
            padding: 5px 10px;
        }

        .circle{
            text-align: center;
        }
        .circle .glyphicon-check{
            visibility: hidden;
        }

        .circleButton{
            width: 48px;
            height: 48px;
            border-radius: 20px;
            background: url("../images/bussiness.png");
            display: inline-block;
        }
        .circleButtonLabel{
            text-align: center;
            padding: 5px 0px;
        }

        .circleSelected{

        }

        .circleSelected  .glyphicon-check{
            color: #00CC00;
            top: 35px;
            left: 25px;
            visibility: visible;
        }
        .circleSelected  .circleButtonLabel{
            color: #90111a;
        }


        #searchList>ul {
            padding-left: 0px;
            list-style-type: none;
            height: 375px;
            overflow-y: auto;
        }

        #searchList>ul>li{
            padding: 5px 10px;
            border-bottom: 3px solid #e5e5e5;
        }

        #searchList>ul>li>div.media>div.media-left{
            display: inline-block;
            float: left;
            width: 84px;
            height: 84px
        }
        #searchList>ul>li>div.media>div.media-left>img{
            width: 84px;
            height: 84px;
            vertical-align: middle
        }

        #searchList>ul>li>div.media>div.media-body{
            display: inline-block;
            float: left;
            padding-left: 20px
        }

        #searchList>ul>li>div.media>div.media-body>.media-heading{
            font-weight: 600;
            width: 100%;
            padding-bottom: 5px;
        }

        #searchList>ul>li>div.media>div.media-body>.media-heading>span.infoSeq{
            width: 24px;
            height: 24px;
            border-radius: 2px;
            display: block;
            text-align: center;
            line-height: 24px;
            color: #fff;
            float: left;
            font-weight: 300;
            background-color: #00CC00;
        }
        #searchList>ul>li>div.media>div.media-body>.media-heading>span.infoName{
            margin-left: 10px;
        }
        #searchList>ul>li>div.media>div.media-body>.media-heading>div{
            float: left;
        }
        #searchList>ul>li>div.media>div.media-body>div{
            padding-left: 35px;
        }
        #searchList>ul>li>div.media>div.media-body>div>.infoTitle{
            font-weight: 600;
        }
        #searchList>ul>li>div.media>div.media-body>div>.infoContent{
            color:#C1BCB6;
            font-weight: 600;
        }

        ul.fields>li>label:nth-child(2){
            width: auto;
        }
    </style>
</head>
<body style="overflow: hidden;">
<div id="container" class="mapUI">
    <div id="mainContainer" class="fulllScreen">
        <div id="searchBar" class="normal">
            <div id="searchResultBar">
                <div class="input-group">
                    <span class="input-group-addon"><</span>
                    <input type="search" class="form-control" />
                    <span id="clearSearch" class="input-group-addon">x</span>
                </div>
            </div>
            <div id="searchStartBar">
                <div class="input-group">
                    <span class="input-group-addon"><i class="glyphicon glyphicon-search"></i><a href='#'  onclick="backToMain()" class="glyphicon glyphicon-search"></a></span>
                    <input id="searchInput" type="search" class="form-control"  readonly="readonly" style="background-color: #fff;"/>
                </div>
            </div>
        </div>
        <div id="map"></div>
        <div id="searchList">
            <ul>

            </ul>
        </div>
    </div>
    <div id="conditionContainer" style="display: none">
        <div class="wrapper" style="box-shadow:none;background-color: #00b3ee">
            <div class="items" style="line-height: 30px;padding: 0px 15px;font-weight: 700;border: 0;text-align: center;color: #fff">
                <span id="conditionBack" style="float: left;color:#fff">返回</span>
                综合查询
            </div>
        </div>
        <div id="property" class="wrapper" style="box-shadow:none;">
            <div class="items" style="line-height: 30px;padding: 0px 15px;font-weight: 700;border: 0;text-align: center;color: #5e5e5e">
                <label for="house"><input id="house" name="property" type="radio" checked value="1" />房产</label>
                <label for="land"><input id="land" name="property"  type="radio" value="2" />地产</label>
            </div>
        </div>
        <div id="format" class="wrapper" style="border-bottom: 1px solid #e8e8e8;box-shadow:none">
            <div class="items" style="line-height: 39px;padding: 0px 18px;font-weight: 700;border: 0;border-bottom: 1px solid #e8e8e8">
                资产业态
            </div>
            <div style="width: 100%;padding: 5px 10px;height:170px; ">
                <table cellpadding="none" cellspacing="none" style="border: none;width: 100%">
                    <tr>
                        <td>
                            <label class="circle"  for="bussinessLand">
                                <div class="circleButton">
                                    <i class="glyphicon glyphicon-check"></i>
                                </div>
                                <div class="circleButtonLabel"><label>商业用房</label><input id="bussinessLand" value="1"  type="checkbox" style="display: none" /></div>
                            </label>
                        </td>
                        <td>
                            <label class="circle"  for="industryLand">
                                <div class="circleButton">
                                    <i class="glyphicon glyphicon-check"></i>
                                </div>
                                <div class="circleButtonLabel"><label>工业用房</label><input id="industryLand" value="5"  type="checkbox" style="display: none" /></div>
                            </label>
                        </td>
                        <td>
                            <label class="circle" for="building" >
                                <div class="circleButton">
                                    <i class="glyphicon glyphicon-check"></i>
                                </div>
                                <div class="circleButtonLabel"><label>写字楼</label><input id="building" value="2"  type="checkbox" style="display: none" /></div>
                            </label>
                        </td>
                        <td>
                            <label class="circle" for="hotel" >
                                <div class="circleButton">
                                    <i class="glyphicon glyphicon-check"></i>
                                </div>
                                <div class="circleButtonLabel"><label for="hotel">酒店</label><input id="hotel"  value="3"  type="checkbox" style="display: none" /></div>
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label class="circle" for="home" >
                                <div class="circleButton">
                                    <i class="glyphicon glyphicon-check"></i>
                                </div>
                                <div class="circleButtonLabel"><label>住宅</label><input id="home" value="4"  type="checkbox" style="display: none" /></div>
                            </label>
                        </td>
                        <td>
                            <label class="circle" for="selfUse" >
                                <div class="circleButton">
                                    <i class="glyphicon glyphicon-check"></i>
                                </div>
                                <div class="circleButtonLabel"><label>自用</label><input id="selfUse"  value="6"  type="checkbox" style="display: none" /></div>
                            </label>
                        </td>
                        <td>
                            <label class="circle" for="else" >
                                <div class="circleButton">
                                    <i class="glyphicon glyphicon-check"></i>
                                </div>
                                <div class="circleButtonLabel"><label>其他</label><input id="else"  value="7"  type="checkbox" style="display: none" /></div>
                            </label>
                        </td>
                        <td>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div id="company" class="wrapper" style="box-shadow:none">
            <div class="items" style="line-height: 39px;padding: 0px 18px;font-weight: 700;border: 0;">
                运营公司
            </div>
            <div style="padding-top: 5px">
                <select id="propertyCompanySelect" data-toggle="select" name="inverse-select" class="form-control">
                </select>
            </div>
        </div>
        <div id="area" class="wrapper" style="box-shadow:none">
            <div class="items" style="line-height: 39px;padding: 0px 18px;font-weight: 700;border: 0;">
                行政区划
            </div>
            <div style="padding-top: 5px">
                <select id="propertyAreaSelect" data-toggle="select" name="inverse-select" class="form-control" >
                </select>
            </div>
        </div>
        <div id="" class="wrapper" style="padding-top:15px;box-shadow:none">
            <a id="searchButton" href="#" class="btn btn-success btn-block">搜索</a>
        </div>
    </div>
    <div id="info" style="width: 100%;height: 100%;display: none">
        <div class="wrapper" style="box-shadow:none;background-color: #00b3ee">
            <div class="items" style="line-height: 30px;padding: 0px 15px;font-weight: 700;border: 0;text-align: center;color: #fff">
                <span id="landInfoBack" style="float: left;color:#fff">返回</span>
                地产信息
            </div>
        </div>
        <img  style="width: 100%;height: 200px" id="landImg"/>
        <ul class="fields" style="">
            <li><label>使用权人：</label><label id="tdsyr">---</label></li>
            <li><label>使用面积：</label><label id="symj">---</label></li>
            <li><label>座落：</label><label id="dczuoluo">---</label></li>
            <li><label>土地证书编号：</label><label id="tdzbh">---</label></li>
            <li><label>终止日期：</label><label id="zzdate">---</label></li>
        </ul>
        <div class='wrapper'>
            <ul class='items'>
                <li>
                    <a href='#'>对应房产信息<i class="glyphicon glyphicon-chevron-right"></i></a>
                    <ul class='sub-items' id="dydcxx">
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <div id="houseInfo" style="overflow: auto;display: none">
        <div class="wrapper" style="box-shadow:none;background-color: #00b3ee">
            <div class="items" style="line-height: 30px;padding: 0px 15px;font-weight: 700;border: 0;text-align: center;color: #fff">
                <span id="hourseInfoBack" style="float: left;color:#fff">返回</span>
                房产信息
            </div>
        </div>
        <img  style="width: 100%;height: 200px"  id="houseImg" />
        <ul class="fields" style="">
            <li><label>业主：</label><label id="yezhu">---</label></li>
            <li><label>建筑面积：</label><label id="jzmj">---</label></li>
            <li><label>业态：</label><label id="yetai">---</label></li>
            <li><label>座落：</label><label id="zuoluo">---</label></li>
            <li><label>出租率：</label><label id="czl">---</label></li>
            <li><label>现平均单价：</label><label id="xpjdj">---</label></li>
        </ul>
        <div class='wrapper'>
            <ul class='items'>
                <li>
                    <a href='#'>对应地产信息<i class="glyphicon glyphicon-chevron-right"></i></a>
                    <ul class='sub-items'>
                        <li>
                            <ul class="fields" style="padding-left: 0px;border: none" id="dyfcxx">
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</div>

</body>
<script src="../lib/Flat-UI-master/dist/js/vendor/jquery.min.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=AXQ7RGL4oSjsANXUG8OQofPywGmb04QV"></script>
<script src="../lib/select2-master/dist/js/select2.full.min.js"></script>
<script type="text/javascript" src="../lib/echarts/echarts.js"></script>
<script src="../scripts/Application.js"></script>
<script src="../scripts/Application.Util.js"></script>
<script type="text/javascript">
    var lastContainer="mainContainer";
    Application.userid = getQueryString("cuserid");
    var laneParam = {
        'location': '',
        'yetai': '',
        'userid': Application.userid,
        'gongsi': '',
        'dijiye': '',
        'xianshitiaoshu': '100000',
        'tdsyr ': '',
        'dl': '',
        'tdxz': '',
        'syqmj': '',
        'zzdate': '',
        'syqmjpx': '',
        'zzdatepx': ''
    };
    var houseParam = {
        'location': '',
        'yetai': '',
        'userid': Application.userid,
        'gongsi': '',
        'dijiye': '',
        'xianshitiaoshu': '100000',
        'tdsyr ': '',
        'dl': '',
        'tdxz': '',
        'syqmj': '',
        'zzdate': '',
        'syqmjpx': '',
        'zzdatepx': ''
    };
    var buildingParam = {
        'location': '',
        'yetai': '',
        'userid': Application.userid,
        'gongsi': '',
        'dijiye': '',
        'xianshitiaoshu': '',
        'xmmc ': '',
        'ldh ': ''
    };
    var hugParam = {
        'location': '',
        'yetai': '',
        'userid': Application.userid,
        'gongsi': '',
        'dijiye': '',
        'xianshitiaoshu': '',
        'fjbh ': '',
        'ldh ': ''
    };
    var queryZoneData = [];
    var queryCompanyData = [];
    var queryRetailData = [];
    $(function () {
        initmap();

        $("#clearSearch").click(function () {
            $("#mainContainer").removeClass("halfScreen").addClass("fulllScreen");
        })

        $("#searchInput").focus(function () {
            $("#container>div").hide();
            $("#conditionContainer").show();
            lastContainer = "mainContainer";
            getOrgAndLocation(Application.userid);
        })

        $(".circleButtonLabel>input").click(function () {
            if ($(this).parents('.circle').hasClass("circleSelected")) {
                $(this).parents('.circle').removeClass("circleSelected");
            }
            else {
                $(this).parents('.circle').addClass("circleSelected");
            }
        });
         //登录时数据
        houseOfLogin();
        laneOfLogin();



        // 搜索按钮隐藏其他div，显示带搜索结果的map Div
        $("#searchButton").click(function () {
            if ($("#house").is(":checked")) {
                searchType = "house";
            }
            else {
                searchType = "lane";
            }


            queryRetailData = [];
            queryCompanyData = [];
            queryZoneData = [];
            var properties = $(".circleButtonLabel>input");
            for (var i = 0; i < properties.length; i++) {
                if ($(properties[i]).is(":checked")) {
                    queryRetailData.push($(properties[i]).val())
                }
            }

            var companies = $('#propertyCompanySelect').select2("val");
            queryCompanyData = companies;

            var zones = $('#propertyAreaSelect').select2('val');
            queryZoneData = zones;
            queryDataFromTree();

            $("#container>div").hide();
            $("#mainContainer").removeClass("fullScreen").addClass("halfScreen").show();
        });

        $("#info div.wrapper ul.sub-items>li").click(function () {
            $("#container>div").hide();
            $("#houseInfo").show();

            lastContainer = "info";
        });

        $("#conditionBack").click(function () {
            $("#container>div").hide();
            $("#mainContainer").show();
            lastContainer = "conditionContainer";
        });

        $("#landInfoBack").click(function () {
            $("#container>div").hide();
            $("#mainContainer").show();
            lastContainer = "info";
        });

        $("#hourseInfoBack").click(function () {
            if (lastContainer == "info") {
                $("#container>div").hide();
                $("#info").show();
            }
            else {
                $("#container>div").hide();
                $("#mainContainer").show();
            }

            lastContainer = "houseInfo";
        });
    });
    var map ;
    //初始化地图， 百度地图API功能
    function initmap() {
        map = new BMap.Map("map", { minZoom: Application.minZoom, enableHighResolution: true });    // 创建Map实例

        map.centerAndZoom(new BMap.Point(Application.initCenter[0],Application.initCenter[1]), Application.initZoom);  // 初始化地图,设置中心点坐标和地图级别
        map.setCurrentCity("北京");          // 设置地图显示的城市 此项是必须设置的
        map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
//        return map;
    }

    function getOrgAndLocation(userid) {
        Application.Util.ajaxConstruct(Application.serverHost,'POST',{ userid: Application.userid },'text/xml;charset=UTF-8',function (data) {
            OrgAndLocationOptions(data);
        },function name(params) {
            console.log('error')
        }, {
            "xmlns": 'xmlns:jin="http://web.pims.itf.nc/JingYingZhuangKuang"',
            "xmlnsName": "jin",
            "methodName": "getPk_orgAndLocation"
        })
    }

    function initAccordion(){
        if ($(".items > li > a").hasClass("expanded")) {
            $(".items > li > a").removeClass("expanded");
            $(".items > li > a").find('i').addClass("glyphicon-chevron-right").removeClass("glyphicon-chevron-down");
        }
        $(".items > li > a").unbind('click');
        $(".items > li > a").click(function(e) {
            e.preventDefault();
            var $this = $(this);
            if ($this.hasClass("expanded")) {
                $this.removeClass("expanded");
                $this.find('i').addClass("glyphicon-chevron-right").removeClass("glyphicon-chevron-down");
            } else {
                $(".items a.expanded>i").addClass("glyphicon-chevron-right").removeClass("glyphicon-chevron-down");
                $(".items a.expanded").removeClass("expanded");
                $this.addClass("expanded");
                $this.find("i").addClass("glyphicon-chevron-down").removeClass("glyphicon-chevron-right");
                $(".sub-items").filter(":visible").slideUp("normal");
            }
            $this.parent().children("ul").stop(true, true).slideToggle("normal");
        });

        $(".sub-items a").click(function() {
            $(".sub-items a").removeClass("current");
            $(this).addClass("current");
        });
    }

    function initBarChart(id,data) {
        var dom = document.getElementById(id);
        var myChart = echarts.init(dom);

        var xAxis = [];
        var chuzulv = [];
        var danjia = [];

        for(var i=0,len =data.length; i<len; i++){
            xAxis.push(data[i].year);
            chuzulv.push(data[i].chuzulv);
            danjia.push(data[i].pingjundanjia);
        }



        var app = {};
        option = {
            backgroundColor: '#fff',
            tooltip: {
                trigger: 'axis'
            },
            toolbox: {
                show: true,
                feature: {
                    mark: { show: false },
                    dataView: { show: false, readOnly: false },
                    magicType: { show: false, type: ['line', 'bar'] },
                    restore: { show: false },
                    saveAsImage: { show: true }
                }
            },
            calculable: true,
            legend: {
                orient : 'horizontal',
                x : 'center',
                y:'bottom',
                data:['出租率','单价']
            },
            xAxis: [
                {
                    type: 'category',
                    data: xAxis
                }
            ],
            yAxis: [
                {
                    type: 'value',
                    name: '100%',
                    axisLabel: {
                        formatter: '{value}'
                    }
                },
                {
                    type: 'value',
                    name: '单价',
                    axisLabel: {
                        formatter: '{value}元'
                    }
                }
            ],
            series : [
                {
                    name:'出租率',
                    type:'bar',
                    itemStyle:{
                        normal:{color:'#0099FF'}
                    },
                    data:chuzulv
                },
                {
                    name: '单价',
                    type: 'line',
                    yAxisIndex: 1,
                    itemStyle:{
                        normal:{color:'#C06410'}
                    },
                    data:danjia
                }
            ]
        };

        if (option && typeof option === "object") {
            myChart.setOption(option, true);
        }
    }
    function queryDataFromTree() {
        switch (searchType) {
            case "lane" :
                laneParam.dijiye = 0;
                laneParam.xianshitiaoshu = 10000;
                laneParam.gongsi = queryCompanyData? queryCompanyData.toString() : '';
                if(laneParam.gongsi === 'test'||laneParam.gongsi === '全部') {
                    laneParam.gongsi = '';
                }
                laneParam.yetai = queryRetailData.toString();
                laneParam.location = queryZoneData? queryZoneData.toString() : '';
                if(laneParam.location === 'test'||laneParam.location === '全部') {
                    laneParam.location = '';
                }
                initTableOfLane();
                break;
            case 'house' :
                houseParam.dijiye = 0;
                houseParam.xianshitiaoshu = 10000;
                houseParam.gongsi =queryCompanyData? queryCompanyData.toString() : '';
                if(houseParam.gongsi === 'test'||houseParam.gongsi === '全部') {
                    houseParam.gongsi = '';
                }
                houseParam.yetai = queryRetailData.toString();
                houseParam.location =queryZoneData? queryZoneData.toString() : '';
                if(houseParam.location === 'test'||houseParam.location === '全部') {
                    houseParam.location = '';
                }

                initTableOfHouse();
                break;
        }
    }

    //生成按公司下拉列表
    function OrgAndLocationOptions(data) {
        var companyarr = [];
        var locationObj = {};
        for (var i = 0, len = data.length; i < len; i++) {
            companyarr.push({ id: data[i].firstvalue, text: data[i].secondvalue, location: data[i].location });
            locationObj[data[i].firstvalue] = data[i].location;
        }

        $('#propertyCompanySelect').select2({
            allowClear:true,
            theme:"bootstrap",
            tags:true,
            multiple: true,
            data: companyarr
        }).on('select2:select', function (e) {
            var areaArr = [];
            areaArr.push({ id: 'test', text: '全部' });
            for (var i = 0, len = locationObj[e.params.data.id].length; i < len; i++) {
                areaArr.push({ id:  locationObj[e.params.data.id][i].secondvalue, text: locationObj[e.params.data.id][i].secondvalue })
            }
            $('#propertyAreaSelect').empty();
            $('#propertyAreaSelect').select2({
                allowClear:true,
                theme:"bootstrap",
                tags:true,
                multiple: true,
                data: areaArr
            }).on('select2:select', function (event) {
            });
        });

        $('#propertyAreaSelect').select2({
            data: [{ id: 'test', text: "全部" }]
        });
    }

     //登录时显示的数据
    function houseOfLogin() {
        var myIcon = new BMap.Icon("../images/houseMarker.png", new BMap.Size(24, 24));
        Application.Util.ajaxConstruct(Application.serverHost, 'POST', houseParam, 'text/xml;charset=UTF-8', function (data) {
            if(data.rows.length>0){
                for (var j = 0, len = data.rows.length; j < len; j++)  {
                    var point = new BMap.Point(data.rows[j].lng, data.rows[j].lat );
                    var marker =new BMap.Marker(point,{title: JSON.stringify(data.rows[j]), icon: myIcon});
                    (function () {
                        marker.addEventListener('click',function (e) {
                            $("#searchList>ul").empty();
                            $("#mainContainer").removeClass("fullScreen").addClass("halfScreen").show();
                            var str = constructHouseList([JSON.parse(this.z.title)]);
                            $("#searchList>ul").append(str);
                            initDcOrFcPanel();
                        })
                    })()

                    map.addOverlay(marker);
                }
            }
            else{
                alert("查无数据!")
            }
        }, function name(params) {
            console.log('error');
        }, {
            "xmlns": 'xmlns:jin="http://web.pims.itf.nc/JingYingZhuangKuang"',
            "xmlnsName": "jin",
            "methodName": "getFcXinXi"
        });
    }
    function initTableOfHouse() {
        Application.Util.ajaxConstruct(Application.serverHost, 'POST', houseParam, 'text/xml;charset=UTF-8', function (data) {
            if(data.rows.length>0){
                var points = [];
                $("#searchList>ul").empty();
                map.clearOverlays();
                var str = constructHouseList(data.rows);
                $("#searchList>ul").append(str);
                for (var j = 0, len = data.rows.length; j < len; j++) {
                    var point = new BMap.Point(data.rows[j].lng, data.rows[j].lat);
                    points.push(point);
                    var marker =new BMap.Marker(point,{title: JSON.stringify(data.rows[j])});
                    (function () {
                        marker.addEventListener('click',function (e) {
                            $("#searchList>ul").empty();
                            $("#mainContainer").removeClass("fullScreen").addClass("halfScreen").show();
                            var str = constructHouseList([JSON.parse(this.z.title)]);
                            $("#searchList>ul").append(str);
                            initDcOrFcPanel();
                        })
                    })()
                    map.addOverlay(marker);
                }
                map.setViewport(points);
                initDcOrFcPanel();
            }
            else{
                alert("查无数据!")
            }
        }, function name(params) {
            console.log('error')
        }, {
            "xmlns": 'xmlns:jin="http://web.pims.itf.nc/JingYingZhuangKuang"',
            "xmlnsName": "jin",
            "methodName": "getFcXinXi"
        });
    }
    // 登录时显示的lane数据
    function  laneOfLogin() {
        var myIcon = new BMap.Icon("../images/landMarker.png", new BMap.Size(24, 24));
        Application.Util.ajaxConstruct(Application.serverHost, 'POST', laneParam, 'text/xml;charset=UTF-8', function (data) {
            if(data.rows.length>0){
//                map.clearOverlays();
                for (var j = 0, len = data.rows.length; j < len; j++) {
                    var point = new BMap.Point(data.rows[j].lng, data.rows[j].lat);
                    var marker =new BMap.Marker(point,{title: JSON.stringify(data.rows[j]), icon: myIcon});
                    (function () {
                        marker.addEventListener('click',function (e) {
                            $("#searchList>ul").empty();
                            $("#mainContainer").removeClass("fullScreen").addClass("halfScreen").show();
                            var str = constructLandList([JSON.parse(this.z.title)]);
                            $("#searchList>ul").append(str);
                            initDcOrFcPanel();
                        })
                    })()

                    map.addOverlay(marker);
                }
            }
            else{
                alert("查无数据!")
            }
        }, function name(params) {
            console.log('error')
        }, {
            "xmlns": 'xmlns:jin="http://web.pims.itf.nc/JingYingZhuangKuang"',
            "xmlnsName": "jin",
            "methodName": "getDcXinXi"
        });
    }
    function initTableOfLane() {
        Application.Util.ajaxConstruct(Application.serverHost, 'POST', laneParam, 'text/xml;charset=UTF-8', function (data) {
            if(data.rows.length>0){
                var points = [];
                map.clearOverlays();
                $("#searchList>ul").empty();
                var str = constructLandList(data.rows);
                $("#searchList>ul").append(str);
                for (var j = 0, len = data.rows.length; j < len; j++) {
                    var point = new BMap.Point(data.rows[j].lng, data.rows[j].lat);
                    points.push(point);
                    var marker =new BMap.Marker(point,{title: JSON.stringify(data.rows[j])});
                    (function () {
                        marker.addEventListener('click',function (e) {
                            $("#searchList>ul").empty();
                            $("#mainContainer").removeClass("fullScreen").addClass("halfScreen").show();
                            var str = constructHouseList([JSON.parse(this.z.title)]);
                            $("#searchList>ul").append(str);
                            initDcOrFcPanel();
                        })
                    })()
                    map.addOverlay(marker);
                }
                map.setViewport(points);
                initDcOrFcPanel();
            }
            else{
                alert("查无数据!")
            }
        }, function name(params) {
            console.log('error')
        }, {
            "xmlns": 'xmlns:jin="http://web.pims.itf.nc/JingYingZhuangKuang"',
            "xmlnsName": "jin",
            "methodName": "getDcXinXi"
        });
    }

    function initDCPanel(id, callback) {
        Application.Util.ajaxConstruct(Application.serverHost, 'POST', {'tdzbh': id, userid: Application.userid}, 'text/xml;charset=UTF-8', function (data) {
            callback(data);
        }, function name(params) {
            console.log('error')
        }, {
            "xmlns": 'xmlns:jin="http://web.pims.itf.nc/JingYingZhuangKuang"',
            "xmlnsName": "jin",
            "methodName": 'getDiChanPanel'
        });
    };

    function initFCPanel(id, callback) {
        Application.Util.ajaxConstruct(Application.serverHost, 'POST', {'fczbh': id, userid: Application.userid}, 'text/xml;charset=UTF-8', function (data) {
            callback(data);
        }, function name(params) {
            console.log('error')
        },
        {
            "xmlns": 'xmlns:jin="http://web.pims.itf.nc/JingYingZhuangKuang"',
            "xmlnsName": "jin",
            "methodName": 'getFangChanPanel'
        });
    }

    function otherInfoDc(data) {
        var htmlArr = [];

        htmlArr.push('<li type="house" class="list-item" id="'+data.tdzbh_pk+'" onclick="dcOrFcPanel(event)">');
        htmlArr.push('<div style="width: 100%;padding: 10px 20px">');

        htmlArr.push('<div><span>'+data.fwmc+'</span></div>');
        htmlArr.push('<div><span>'+data.fwsyqr+'</span></div>');

        htmlArr.push('</div> </li>');
        return htmlArr;
    }

    function otherInfo(data) {
        var htmlArr = [];

        htmlArr.push('<li type="land" class="list-item" id="'+data.tdzbh_pk+'" onclick="dcOrFcPanel(event)">');
        htmlArr.push('<div style="width: 100%;padding: 10px 20px">');

        htmlArr.push('<div><span>'+data.tdsyr+'</span></div>');
        htmlArr.push('<div><span>'+data.zuoluo+'</span></div>');

        htmlArr.push('</div> </li>');
        return htmlArr;
    }

    function constructHouseList(data){
        var str="";
        for(var i=0;i<data.length;i++){
            str+='<li type="house" data-id="'+data[i].zhujian+'">'
                    +'<div class="media">'
                    +'<div class="media-left" href="#">'
                    +'<img src="'+data[i].img+'" alt="">'
                    +'</div>'
                    +'<div class="media-body">'
                    +'<h4 class="media-heading"><span class="infoSeq">'+i+'</span><span class="infoName">'+data[i]["fwsyqr"]+'</span></h4>'
                    +'<div><span class="infoTitle">项目名称：</span><span class="infoContent">'+data[i]["fwmc"]+'</span></div>'
                    +'<div><span class="infoTitle">建筑面积：</span><span class="infoContent">'+data[i]["jzmj"]+'</span></div>'
                    +'<div><span class="infoTitle">运营公司：</span><span class="infoContent">'+data[i]["yygs"]+'</span></div>'
                    +'</div>'
                    +'</div>'
                    +'</li>'
        }
        return str;
    }

    function constructLandList(data){
        var str="";
        for(var i=0;i<data.length;i++){
            str+='<li type="land" data-id="'+data[i].zhujian+'">'
                    +'<div class="media">'
                    +'<div class="media-left" href="#">'
                    +'<img src="'+data[i].img+'" alt="">'
                    +'</div>'
                    +'<div class="media-body">'
                    +'<h4 class="media-heading"><span class="infoSeq">'+i+'</span><span class="infoName">'+data[i]["tdsyr"]+'</span></h4>'
                    +'<div><span class="infoTitle">土地使用人：</span><span class="infoContent">'+data[i]["tdsyr"]+'</span></div>'
                    +'<div><span class="infoTitle">使用面积：</span><span class="infoContent">'+data[i]["syqmj"]+'</span></div>'
                    +'<div><span class="infoTitle">终止日期：</span><span class="infoContent">'+data[i]["zzdate"]+'</span></div>'
                    +'</div>'
                    +'</div>'
                    +'</li>'
        }
        return str;
    }
    function dcOrFcPanel(event) {
        $('#houseInfo').hide();
        $('#info').hide();
        if(event.currentTarget.type=="land"){
            var id = event.currentTarget.id;
            initDCPanel(id, function (data) {
                var dataDc= data.diChanPanelXinxi;
                $('#tdsyr').text(dataDc.tdsyr);
                $('#symj').text(dataDc.symj);
                $('#dczuoluo').text(dataDc.zuoluo);
                $('#tdzbh').text(dataDc.tdzbh);
                $('#zzdate').text(dataDc.zzdate);

                $('#landImg').attr('src', dataDc.img[0].accessory_id);
                initBarChart("barChart", dataDc);
                initAccordion();
                var dataOhter = data.diChanPanelDuiyingFangChanXinxi;
                for (var i = 0, len =dataOhter.length; i < len ; i++) {
                    var list = otherInfoDc(dataOhter[i]);
                    $("#dydcxx").append(list.join(''));
                }
            });
            $("#info").show();
        }
        else{
            var fczbh= event.currentTarget.id;
            initFCPanel(fczbh,function (data) {
                var dataFc = data.fangChanPanelXinxi;
                $('#yezhu').text(dataFc.yezhu);
                $('#jzmj').text(dataFc.jzmj);
                $('#yetai').text(dataFc.yetai);
                $('#zuoluo').text(dataFc.zuoluo);
                $('#czl').text(dataFc.chuzulv);
                $('#xpjdj').text(dataFc.punjundanjia);

                $('#houseImg').attr('src', dataFc.img[0].accessory_id);
                initBarChart("barChart", dataFc);
                initAccordion();
                var dataOhter = data.fangChanPanelDuiyingDiChanXinxi;
                for (var i = 0, len = dataOhter.length; i < len; i++) {
                    var list = otherInfo(dataOhter[i]);
                    $("#dyfcxx").append(list.join(''));
                }
            });
            $("#houseInfo").show();
        }
        lastContainer="mainContainer";
    }
    function initDcOrFcPanel(){
        // 点击搜索结果，跳转相关房产、地产div
        $("#searchList li").click(function(){
            $("#container>div").hide();
            if($(this).attr("type")=="land"){
                var id=$(this).attr("data-id");
                initDCPanel(id, function (data) {
                    var dataDc= data.diChanPanelXinxi;
                    $('#tdsyr').text(dataDc.tdsyr);
                    $('#symj').text(dataDc.symj);
                    $('#dczuoluo').text(dataDc.zuoluo);
                    $('#tdzbh').text(dataDc.tdzbh);
                    $('#zzdate').text(dataDc.zzdate);
//                    initBarChart("barChart", dataDc);
                    $('#landImg').attr('src', dataDc.img[0].accessory_id);
                    initAccordion();
                    var dataOhter = data.diChanPanelDuiyingFangChanXinxi;
                    $("#dydcxx").empty();
                    for (var i = 0, len =dataOhter.length; i < len ; i++) {
                        var list = otherInfoDc(dataOhter[i]);
                        $("#dydcxx").append(list.join(''));
                    }
                });
                $("#info").show();
            }
            else{
                var fczbh=$(this).attr("data-id");
                initFCPanel(fczbh,function (data) {
                    var dataFc = data.fangChanPanelXinxi;
                    $('#yezhu').text(dataFc.yezhu);
                    $('#jzmj').text(dataFc.jzmj);
                    $('#yetai').text(dataFc.yetai);
                    $('#zuoluo').text(dataFc.zuoluo);
                    $('#czl').text(dataFc.chuzulv);
                    $('#xpjdj').text(dataFc.punjundanjia);
//                    initBarChart("barChart",  dataFc);
                    $('#houseImg').attr('src', dataFc.img[0].accessory_id);
                    initAccordion();
                    var dataOhter = data.fangChanPanelDuiyingDiChanXinxi;
                    $("#dyfcxx").empty();
                    for (var i = 0, len = dataOhter.length; i < len; i++) {
                        var list = otherInfo(dataOhter[i]);
                        $("#dyfcxx").append(list.join(''));
                    }
                });
                $("#houseInfo").show();
            }
            lastContainer="mainContainer";
        });
    }

    //生成marker
    function createMarker(options) {
        var opts = {
            position: options.point   // 指定文本标注所在的地理位置
        };
        var label = new BMap.Label("", opts);
        label.setContent(options.html);
        label.setStyle(options.style);
        label.addEventListener('mouseover', function (event) {
            event.target.setZIndex(1000)
        });
        return label;
    }
 // 返回main.html
    function backToMain() {
        window.location = 'main.html?cuserid=' + Application.userid;
    }
</script>
</html>